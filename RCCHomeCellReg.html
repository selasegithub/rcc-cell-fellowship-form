<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RCC Home Cell Fellowship Registration</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBNIPH3XJcE6vDyBaMavbxyiGBmKEiQQak&libraries=places"></script>
</head>
<body>
    <div class="container">
        <h4>RCC Home Cell Fellowship Registration</h4>
        <form id="myHomeCellForm">
            <div class="row">
                <div class="input-field col s6">
                    <input id="first_name" name="first_name" type="text" class="validate" required>
                    <label for="first_name">First Name</label>
                </div>
                <div class="input-field col s6">
                    <input id="last_name" name="last_name" type="text" class="validate" required>
                    <label for="last_name">Last Name</label>
                </div>
            </div>
            <div class="row">
                <div class="input-field col s6">
                    <select id="gender" name="gender" required>
                        <option value="" disabled selected>Choose your option</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                    </select>
                    <label for="gender">Gender</label>
                </div>
                <div class="input-field col s6">
                    <select id="birth_month" name="birth_month">
                        <option value="" disabled selected>Choose your option</option>
                        <option value="January">January</option>
                        <option value="February">February</option>
                        <option value="March">March</option>
                        <option value="April">April</option>
                        <option value="May">May</option>
                        <option value="June">June</option>
                        <option value="July">July</option>
                        <option value="August">August</option>
                        <option value="September">September</option>
                        <option value="October">October</option>
                        <option value="November">November</option>
                        <option value="December">December</option>
                    </select>
                    <label for="birth_month">Birth Month</label>
                </div>
            </div>
            <div class="row">
                <div class="input-field col s6">
                    <input id="birth_year" type="number" name="birth_year" class="validate">
                    <label for="birth_year">Birth Year</label>
                </div>
                <div class="input-field col s6">
                    <input id="email" name="email" type="email" class="validate" required>
                    <label for="email">Email</label>
                    <span class="helper-text" data-error="Invalid email address" data-success="Valid email address"></span>
                </div>
            </div>
            <div class="row">
                <div class="input-field col s6">
                    <select id="phone_type" name="phone_type" onchange="togglePhoneFields()" required>
                        <option value="" disabled selected>Choose your option</option>
                        <option value="US">US Based</option>
                        <option value="International">International</option>
                    </select>
                    <label for="phone_type">Phone Type</label>
                </div>
                <div class="input-field col s6" id="us_phone_field" style="display:none;">
                    <input id="us_phone" name="us_phone" type="tel" pattern="[0-9]{10}" class="validate">
                    <label for="us_phone">US Phone Number (10 digits)</label>
                    <span class="helper-text" data-error="Invalid US phone number" data-success="Valid US phone number"></span>
                </div>
                <div class="input-field col s6" id="intl_phone_field" style="display:none;">
                    <input id="intl_phone" name="intl_phone" type="tel" pattern="[0-9]{13}" class="validate">
                    <label for="intl_phone">International Phone Number (13 digits)</label>
                    <span class="helper-text" data-error="Invalid international phone number" data-success="Valid international phone number"></span>
                </div>
            </div>
            <div class="row">
                <div class="input-field col s12">
                    <div id="locationField">
                        <input id="autocomplete" name="address" type="text" required>
                        <label for="autocomplete">Enter your address</label>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="input-field col s4">
                    <input type="text" id="street_number" name="street_number" disabled="true">
                    <label for="street_number">Street Address</label>
                </div>
                <div class="input-field col s4">
                    <input type="text" id="route" name="route" disabled="true">
                    <label for="route">Route</label>
                </div>
                <div class="input-field col s4">
                    <input type="text" id="locality" name="locality" disabled="true">
                    <label for="locality">City</label>
                </div>
            </div>
            <div class="row">
                <div class="input-field col s4">
                    <input type="text" id="administrative_area_level_1" name="administrative_area_level_1" disabled="true">
                    <label for="administrative_area_level_1">State</label>
                </div>
                <div class="input-field col s4">
                    <input type="text" id="postal_code" name="postal_code" disabled="true">
                    <label for="postal_code">Zip Code</label>
                </div>
                <div class="input-field col s4">
                    <input type="text" id="country" name="country" disabled="true">
                    <label for="country">Country</label>
                </div>
            </div>
            <div class="row">
                <div class="input-field col s12">
                    <select id="membership" name="membership">
                        <option value="" disabled selected>Choose your option</option>
                        <option value="First Timer">First Timer</option>
                        <option value="Online Family Member">Online Family Member</option>
                        <option value="Rcc Member">RCC Member</option>
                    </select>
                    <label for="membership">Membership</label>
                </div>
            </div>
            <button class="btn waves-effect waves-light" type="submit" name="action">Submit
                <i class="material-icons right">send</i>
            </button>
        </form>
        <!-- Form Response Message -->
        <div id="responseMessage"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var elems = document.querySelectorAll('select');
            M.FormSelect.init(elems);
        });

        function togglePhoneFields() {
            var phoneType = document.getElementById('phone_type').value;
            var usPhoneField = document.getElementById('us_phone_field');
            var intlPhoneField = document.getElementById('intl_phone_field');
            if (phoneType === 'US') {
                usPhoneField.style.display = 'block';
                intlPhoneField.style.display = 'none';
            } else if (phoneType === 'International') {
                usPhoneField.style.display = 'none';
                intlPhoneField.style.display = 'block';
            } else {
                usPhoneField.style.display = 'none';
                intlPhoneField.style.display = 'none';
            }
        }

        var placeSearch, autocomplete;
        var componentForm = {
            street_number: 'short_name',
            route: 'long_name',
            locality: 'long_name',
            administrative_area_level_1: 'short_name',
            country: 'long_name',
            postal_code: 'short_name'
        };

        function initAutocomplete() {
            autocomplete = new google.maps.places.Autocomplete(
                (document.getElementById('autocomplete')), {
                    types: ['geocode']
                });

            autocomplete.addListener('place_changed', fillInAddress);
        }

        function fillInAddress() {
            var place = autocomplete.getPlace();

            for (var component in componentForm) {
                document.getElementById(component).value = '';
                document.getElementById(component).disabled = false;
            }

            for (var i = 0; i < place.address_components.length; i++) {
                var addressType = place.address_components[i].types[0];
                if (componentForm[addressType]) {
                    var val = place.address_components[i][componentForm[addressType]];
                    document.getElementById(addressType).value = val;
                }
            }
        }

        function geolocate() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    var geolocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    var circle = new google.maps.Circle({
                        center: geolocation,
                        radius: position.coords.accuracy
                    });
                    autocomplete.setBounds(circle.getBounds());
                });
            }
        }

        initAutocomplete();

        document.getElementById('myHomeCellForm').addEventListener('submit', function(e) {
            e.preventDefault();
            var formData = new FormData(this);
            // Log form data to console
          for (var pair of formData.entries()) {
            console.log(pair[0]+ ': ' + pair[1]);
          }
          fetch('https://script.google.com/macros/s/AKfycbwSglDDbernCzpLPtF6LDwDy827F42uC85TCI5AxspZAJyQO5Gm9b6Me0t-zrxSrNnc/exec', {
            method: 'POST',
            //mode: 'no-cors',
            body: formData
          })
          .then(response => {
            // Check if the response is JSON
            const contentType = response.headers.get('content-type');
            if (contentType && contentType.includes('application/json')) {
              return response.json();
            } else {
              throw new Error('Server response is not JSON');
            }
          })
          .then(data => {
            document.getElementById('responseMessage').innerText = data.message;
          })
          .catch(error => {
            console.error('Error:', error); // Log the error to the console
            document.getElementById('responseMessage').innerText = 'An error occurred. Please try again.';
            });
        });
    </script>
</body>
</html>
